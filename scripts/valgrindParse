valgrindFile=$1
losses="no"

if [ "$valgrindFile"  == "" ]
then
    echo "Please supply a valgrind output file to be parsed"
    exit 1
fi

cat $valgrindFile > /dev/null 2> /dev/null
if [ "$?" != 0 ]
then
  echo "Please supply an EXISTING valgrind output file to be parsed"
  exit 2
fi

definitely=$(grep 'definitely lost ' $valgrindFile | wc -l)
indirectly=$(grep 'indirectly lost ' $valgrindFile | wc -l)
possibly=$(grep 'possibly lost '     $valgrindFile | wc -l)
reachable=$(grep 'still reachable '  $valgrindFile | wc -l)

definitelyInfo=$(grep 'definitely lost:' $valgrindFile | awk -F: '{ print $2 }')
indirectlyInfo=$(grep 'indirectly lost:' $valgrindFile | awk -F: '{ print $2 }')
possiblyInfo=$(grep 'possibly lost:'     $valgrindFile | awk -F: '{ print $2 }')
reachableInfo=$(grep 'still reachable:'  $valgrindFile | awk -F: '{ print $2 }')



if [ "$definitely" != 0 ]
then
    echo $valgrindFile "- definitely lost in " $definitely " occurences (" $definitelyInfo ")"
    losses="yes"
fi

if [ "$indirectly" != 0 ]
then
    echo $valgrindFile "- indirectly lost in " $indirectly " occurences (" $indirectlyInfo ")"
    losses="yes"
fi

if [ "$possibly" != 0 ]
then
    echo $valgrindFile "- possibly lost in   " $possibly " occurences (" $possiblyInfo ")"
    losses="yes"
fi

if [ "$reachable" != 0 ]
then
    echo $valgrindFile "- still reachable in " $reachable " occurences (" $reachableInfo ")"
    losses="yes"
fi

if [ "$losses" == "no" ]
then
  exit 0
fi

exit 1
