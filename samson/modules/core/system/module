Module system
{
	title	"System default elements"
	author	"Andreu Urruela"
	version "0.3"
}

# System defaults ( to be implemented in the rigth file )

data Value {}
data UInt {}
data String {}
data Void {}
data Int32 {}
data Int16 {}
data Int8 {}
data UInt64 {}
data UInt32 {}
data UInt16 {}
data UInt8 {}
data Double {}
data Float {}

# Very simple implementation for time
# Only provides conversion from (getTimeFromCalendar, just mktime) and to (getCalendarFromTime, just gmtime_r) struct tm expanded format
# For conversions to string, use asctime_r()
data TimeUnix {}

# Standard time and date representations
data Time
{
     system.Int8 hour;
     system.Int8 minute;
     system.Int8 seconds;
}

data Date
{
     system.UInt8 year;
     system.Int8 month;
     system.Int8 day;
     optional system.UInt days_2000;
     optional system.Int8 week_day; 
}

data DateComplete
{
     system.UInt8 year;
     system.Int8 month;
     system.Int8 day;
     system.UInt days_2000;
     system.Int8 week_day; 
}

# Time slot. Useful in mobility solution, and perhaps in other scenarios
data TimeSlot
{
	system.UInt8 wdaysMask;
	system.Int32 initSec;
	system.Int32 finalSec;
}

data ComplexTimeSlot
{
	system.UInt8 flagSet;
	vector system.TimeSlot ts;
	system.UInt8 wdaysMask;
	system.UInt8 wdayFirstDay;
	system.UInt8 monthDays;
	system.UInt8 coveredDays;	
}

data Vector_UInt
{
  vector system.UInt values;	
}

data UInt2
{
	system.UInt value_1;
	system.UInt value_2;
}

data StringVector
{
    vector system.String values;
}



# Value operations

parser parse
{
	out system.Value system.Value
	helpLine "Parse lines with fields separated by a single char tab , space , coma , ..."
}

parser parse_xml_documents
{
	out system.Value system.Value
	helpLine "Parse xml documents and generate system.Values as maps"
}

parser parse_http_with_commscore
{
    out system.Value system.Value
    helpLine "Parse lines from TRAFFICA http logs, enriching with commscore categories"
}

parserOut str
{
	in  system.Value system.Value
	helpLine "Export system.Value system.Value elements to string"
}

map map
{
	in  system.Value system.Value
	out system.Value system.Value

	helpLine "Generic map to transform values. User enviroment variable command to specify what to do..."
}

map map2
{
	in  system.Value system.Value
	out system.Value system.Value
	out system.Value system.Value

	helpLine "Generic map to transform values. User enviroment variable command to specify what to do..."
}

map map3
{
	in  system.Value system.Value
	out system.Value system.Value
	out system.Value system.Value

	helpLine "Generic map to transform values. User enviroment variable command to specify what to do..."
}

reduce reduce
{
    in  system.Value system.Value
    out system.Value system.Value

	helpLine "Reduce all the values for every particular key. Possible commands  sum_double (default) , average_double , max_double  "
}

reduce update
{
    in  system.Value system.Value
    in  system.Value system.Value

    out system.Value system.Value	
    out system.Value system.Value

	helpLine "Update state operations like last_10 , last_1 , ..."

}


reduce process
{
    in  system.Value system.Value
    in  system.Value system.Value

    out system.Value system.Value	
    out system.Value system.Value
    out system.Value system.Value

	helpLine "Generic operation based on ProcessComponents.Useful for generic operations like accumulations"

}

script init_process
{
	code
	{
		add_stream_operation p system.process input state output input state;
	}					 
}

splitter lines
{
	helpLine "Parse input keeping lines toguether"
}


splitter xml_documents
{
	helpLine "Do not break xml documents"
}

