/*
 * Telefónica Digital - Product Development and Innovation
 *
 * THIS CODE AND INFORMATION ARE PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND,
 * EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE.
 *
 * Copyright (c) Telefónica Investigación y Desarrollo S.A.U.
 * All rights reserved.
 */

/**
 File autogenerated with samsonModuleParser. Please, edit to complete this operation
*/

#ifndef _H_SAMSON_url_DecodeServerHits
#define _H_SAMSON_url_DecodeServerHits


#include <samson/module/samson.h>


namespace samson{
namespace url{


	class DecodeServerHits : public samson::Reduce
	{
		samson::system::UInt serverId;
		samson::system::String serverStr;
		PathCountVector paths;

	public:


		void run(  samson::KVSetStruct* inputs , samson::KVWriter *writer )
		{

			if (inputs[1].num_kvs == 0)
			{
				// We don't have statistics for that serverId;
				return;
			}



			serverId.parse(inputs[0].kvs[0]->key);

			if ((inputs[0].num_kvs != 1) || (inputs[1].num_kvs != 1))
			{
				OLM_E(("We should have one and only one occurrence of server(%d) in both lists. inputs[0].num_kvs: %d; inputs[1].num_kvs: %d", serverId.value, inputs[0].num_kvs, inputs[1].num_kvs));
				return;
			}

			serverStr.parse(inputs[0].kvs[0]->value);
			paths.parse(inputs[1].kvs[0]->value);
			writer->emit(0, &serverStr, &paths);
		}


	};


} // end of namespace samson
} // end of namespace url

#endif
