
# ----------------------------------------
# Quijote demo
# ----------------------------------------

# Description: Tools for generic processing without developing any opertion in c++

#Remove everything
remove_all_stream

# Take the input file from a command line:
# cat quijote.txt | samsonPush input
push quijote.txt input

# Flush all generated buffers
flush_buffers

# Get the lines running system.parse
run system.parse input lines  

# Get all the words
run system.map lines words env:command " parse_words |  emit " 

# Reduce all words to get a count per word
run system.reduce words words_total env:command sum

# Get all lengths
run system.map words lengths env:command " select  strlen(key) , 1 | emit "

# Reduce to get histogram of lengths
run system.reduce lengths lengths_total env:command sum

# Get new key-values formed with first letter (key) and the words (value)
run system.map words letter_words env:command " select substr(key,0,1) , key | emit" 

# get the most popular words per letter
run system.reduce letter_words letter_popular_words env:command "top 10" 


#Pop results
pop words_total           result_words_total -force
pop lengths_total         result_lengths_total -force
pop letter_popular_words  result_letter_popular_words -force
