/*
 * Telefónica Digital - Product Development and Innovation
 *
 * THIS CODE AND INFORMATION ARE PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND,
 * EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE.
 *
 * Copyright (c) Telefónica Investigación y Desarrollo S.A.U.
 * All rights reserved.
 */

/**
 File autogenerated with samsonModuleParser. Please, edit to complete this operation
*/

#ifndef _H_SAMSON_testtime_fake_purchases
#define _H_SAMSON_testtime_fake_purchases


#include <samson/module/samson.h>
#include <samson/modules/system/TimeUnix.h>
#include <samson/modules/system/UInt.h>


namespace samson{
namespace testtime{


	class fake_purchases : public samson::Generator
	{

	public:

#define MAX_STR_LEN 1024
                char output[MAX_STR_LEN];

		void run( samson::KVWriter *writer )
		{
			samson::system::TimeUnix tm;
			struct tm timep;
			samson::system::UInt amount;

			size_t num_samples = environment->getInt( "testtime.num_samples", 1000000);
			OLM_T(LMT_User06, ("fake_purchases() for testtime.num_samples:%lu\n", num_samples));

			for (size_t i = 0; (i < num_samples); i++)
			{
				timep.tm_year = 111;
				timep.tm_mon = rand()%12;
				timep.tm_mday = rand()%31 + 1;
				timep.tm_hour = rand()%24;
				timep.tm_min = rand()%60;
				timep.tm_sec = rand()%60;
				timep.tm_wday = 0;
				timep.tm_yday = 0;

//				if (i%100000 == 0)
//				{
//					asctime_r(&timep, output);
//					output[strlen(output)-1] = '\0';
//					OLM_T(LMT_User06, ("Loop:%lu, yday:%d, wday:%d, month:%d, date:'%s'\n", i, timep.tm_yday, timep.tm_wday, timep.tm_mon, output));
//				}

				tm.getTimeUTCFromCalendar(&timep);

				amount.value = rand()%1000;

				if (i%100000 == 0)
				{
					asctime_r(&timep, output);
					output[strlen(output)-1] = '\0';
					OLM_T(LMT_User06, ("Loop:%lu, time:%lu, amount:%lu, yday:%d, wday:%d, month:%d, date:'%s'\n", i, tm.value, amount.value, timep.tm_yday, timep.tm_wday, timep.tm_mon, output));
				}


				writer->emit(0, &tm, &amount);
			}
		}


	};


} // end of namespace samson
} // end of namespace testtime

#endif
