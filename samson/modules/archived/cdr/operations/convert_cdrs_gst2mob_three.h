/*
 * Telefónica Digital - Product Development and Innovation
 *
 * THIS CODE AND INFORMATION ARE PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND,
 * EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE.
 *
 * Copyright (c) Telefónica Investigación y Desarrollo S.A.U.
 * All rights reserved.
 */

/**
 File autogenerated with samsonModuleParser. Please, edit to complete this operation
*/

#ifndef _H_SAMSON_cdr_convert_cdrs_gst2mob_three
#define _H_SAMSON_cdr_convert_cdrs_gst2mob_three


#include <samson/module/samson.h>


namespace samson{
namespace cdr{


	class convert_cdrs_gst2mob_three : public samson::Reduce
	{

	public:


#ifdef INFO_COMMENT //Just to include a comment without conflicting anything
// If interface changes and you do not recreate this file, consider updating this information (and of course, the module file)

input: system.UInt cdr.gstCdr  
input: system.UInt cdr.gstCdr  
input: system.UInt cdr.gstCdr  
output: system.UInt64 cdr.mobCdr

helpLine: Convert three sources of CDRs from Gasset format to Mob format.
extendedHelp: 		Convert three sources of CDRs from Gasset format to Mob format.

#endif // de INFO_COMMENT

		void init(samson::KVWriter *writer )
		{
		}


//Goyo. De momento, parece que esta función no es necesaria.
		void run(  samson::KVSetStruct* inputs , samson::KVWriter *writer )
		{
			//input
			samson::system::UInt phone;
			gstCdr  cdr;

			//output
			samson::system::UInt phone_out;
			mobCdr  cdr_out;


			const int num_inputs = 3;

			//Goyo. Habría que asegurarse que hay, pero probablemente no lo usemos nunca
			phone.parse(inputs[0].kvs[0]->key);

			for(int j=0; j<num_inputs; j++)
			{
				for (size_t i=0  ; i< inputs[j].num_kvs ;i++)
				{

					cdr.parse(inputs[j].kvs[i]->value);
					//phone_out.value = cdr.phone;
					//cdr_out.phone.value  = cdr.phone;
					phone_out.value = phone.value;
					cdr_out.phone.value = phone.value;
					cdr_out.cellId.value = cdr.cellId.value;

					//cdr_out.btsId = 0;
					//cdr_out.lacId = 0;
					//cdr_out.stateId = 0;

					cdr_out.timeUnix = cdr.timeUnix;

					//cdr_out.absDay = 0;

					cdr_out.mobScope.value = cdr.mobScope.value;

					writer->emit(0, &phone_out, &cdr_out);
				}
			}
		}

		void finish(samson::KVWriter *writer )
		{
		}



	};


} // end of namespace samson
} // end of namespace cdr

#endif
