Module tienda
{

	title	"tienda  module"
	author 	"Andreu Urruela (andreu@tid.es)"
	version "0.1"
	
}

# ---------------------------------------------------------------------------
# datas
# ---------------------------------------------------------------------------

data Operation
{
        system.UInt user;
        system.UInt product;
        system.UInt operation;
}

data VectorProducts
{
        vector system.UInt products;
}

generator test_generator
{
        out system.UInt tienda.Operation

        helpLine "Simple generator that generates tienda.Operation operations"
}

generator test_generator_fixed
{
        out system.UInt tienda.Operation

        helpLine "Simple generator that generates fixed tienda.Operation operations (not random)"
}

map map_by_user
{
        in system.UInt tienda.Operation
        out system.UInt system.UInt

        top

        helpLine "Map example; from input_data [UInt - Operation] emits key-values [UInt - UInt] with user-id and product-id"


}

reduce reduce_by_user
{
        in system.UInt system.UInt
        out system.UInt tienda.VectorProducts

        top

        helpLine "Reduce example; from key-values groups the list of products by user"
}

parserOut export_to_txt
{
        in system.UInt tienda.VectorProducts

	helpLine "Export system.UInt tienda.VectorProducts key-values in a standard format. Use tienda.separator to custommize separator"
}

script test_1
{
	out txt txt
	
	helpLine "Test script"
	
	code
	{
		rm -f test_data_operations test_data_op_user  test_data_VectorProducts test_data_VectorProducts ;
		clear $1;
		tienda.test_generator_fixed test_data_operations -clear -create;
		tienda.map_by_user test_data_operations test_data_user_op -clear -create;
		tienda.reduce_by_user test_data_user_op test_data_VectorProducts -clear -create;
		tienda.export_to_txt test_data_VectorProducts $1 -clear -create;
		#rm -f test_data_operations test_data_op_user  test_data_VectorProducts test_data_VectorProducts;
	}
}
